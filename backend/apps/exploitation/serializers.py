"""
Exploitation Serializers
backend/apps/exploitation/serializers.py
"""

from rest_framework import serializers
from .models import (
    ExploitationSession,
    ExploitResult,
    ExploitChain,
    ExploitTemplate
)

class ExploitResultSerializer(serializers.ModelSerializer):
    """Serializer for exploit results"""

    class Meta:
        model = ExploitResult
        fields = [
            'id', 'session', 'payload', 'response_data',
            'success', 'impact_level', 'evidence_files',
            'proof_of_concept', 'timestamp'
        ]
        read_only_fields = ['id', 'timestamp']

class ExploitationSessionSerializer(serializers.ModelSerializer):
    """Serializer for exploitation sessions"""
    results = ExploitResultSerializer(many=True, read_only=True)
    results_count = serializers.SerializerMethodField()
    success_count = serializers.SerializerMethodField()

    class Meta:
        model = ExploitationSession
        fields = [
            'id', 'vulnerability', 'target', 'exploitation_type',
            'status', 'severity', 'started_at', 'completed_at',
            'exploit_chain_data', 'payloads_used', 'notes',
            'automated', 'results', 'results_count', 'success_count'
        ]
        read_only_fields = ['id', 'started_at']

    def get_results_count(self, obj):
        return obj.results.count()

    def get_success_count(self, obj):
        return obj.results.filter(success=True).count()

class ExploitChainSerializer(serializers.ModelSerializer):
    """Serializer for exploit chains"""

    class Meta:
        model = ExploitChain
        fields = [
            'id', 'name', 'description', 'chain_steps',
            'target_vulnerabilities', 'success_rate',
            'created_at', 'updated_at'
        ]
        read_only_fields = ['id', 'created_at', 'updated_at']

class ExploitTemplateSerializer(serializers.ModelSerializer):
    """Serializer for exploit templates"""

    class Meta:
        model = ExploitTemplate
        fields = [
            'id', 'name', 'exploitation_type', 'payload_template',
            'configuration', 'prerequisites', 'created_at', 'updated_at'
        ]
        read_only_fields = ['id', 'created_at', 'updated_at']